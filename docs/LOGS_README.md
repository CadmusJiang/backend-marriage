# 统一日志监控面板

## 概述

统一日志监控面板是一个实时监控系统日志的Web界面，集成了HTTP请求、SQL操作、Redis操作和系统日志的监控功能。

## 功能特性

### 🔍 统一日志视图
- **实时监控**: 自动刷新日志数据
- **多类型日志**: 支持HTTP、SQL、Redis、系统日志的统一展示
- **智能过滤**: 按日志类型、状态、关键词进行过滤
- **分页浏览**: 支持大量日志的分页显示
- **统计信息**: 实时显示各类日志的统计数量

### 🌐 HTTP请求监控
- 请求方法、路径、状态码
- 响应时间统计
- 错误请求高亮显示
- Trace ID追踪

### 🗄️ SQL操作监控
- SQL语句展示
- 执行时间统计
- 影响行数统计
- 调用堆栈信息

### 🔴 Redis操作监控
- Redis命令展示
- 操作耗时统计
- Key信息显示

### ⚙️ 系统日志监控
- 系统级别日志
- 错误信息高亮
- 时间戳显示

## 访问方式

### 1. Web界面访问
```
http://localhost:9999/docs/logs.html
```

### 2. API接口访问
```
# 统一日志API
GET /system/logs/unified

# 日志概览
GET /system/logs

# 最新日志
GET /system/logs/latest
```

## 使用说明

### 自动刷新设置
- 可选择关闭自动刷新或设置5秒、10秒、30秒、1分钟的刷新间隔
- 默认30秒自动刷新

### 过滤功能
1. **日志类型过滤**: 可选择HTTP、SQL、Redis、系统日志
2. **状态过滤**: 可选择成功或失败的请求
3. **关键词搜索**: 支持在日志内容中搜索关键词

### 分页浏览
- 每页显示20条日志记录
- 支持上一页/下一页导航
- 显示当前页码和总页数

## 日志数据结构

### 统一日志条目结构
```json
{
  "id": "日志ID",
  "timestamp": "时间戳",
  "type": "日志类型",
  "level": "日志级别",
  "message": "日志消息",
  "traceId": "追踪ID",
  "method": "HTTP方法",
  "path": "请求路径",
  "statusCode": "HTTP状态码",
  "duration": "请求耗时（秒）",
  "success": "是否成功",
  "error": "错误信息",
  "sqls": "SQL操作列表",
  "sqlCount": "SQL操作数量",
  "redisOps": "Redis操作列表",
  "redisCount": "Redis操作数量",
  "details": "详细信息"
}
```

### SQL操作结构
```json
{
  "timestamp": "执行时间",
  "sql": "SQL语句",
  "stack": "调用堆栈",
  "rows_affected": "影响行数",
  "cost_seconds": "执行耗时"
}
```

### Redis操作结构
```json
{
  "command": "Redis命令",
  "key": "操作的Key",
  "cost_seconds": "执行耗时"
}
```

## 技术实现

### 后端实现
- **日志收集**: 通过GORM插件自动收集SQL操作日志
- **Trace追踪**: 使用统一的Trace ID关联请求链路
- **实时解析**: 解析JSON格式的日志文件
- **智能过滤**: 过滤掉系统内部扫描等无关日志

### 前端实现
- **响应式设计**: 支持桌面和移动设备
- **实时更新**: 使用AJAX轮询获取最新日志
- **交互式过滤**: 动态过滤和搜索功能
- **美观界面**: 现代化的UI设计

## 配置说明

### 日志文件路径
系统默认读取的日志文件路径在配置文件中定义：
```go
configs.ProjectAccessLogFile
```

### 日志格式
系统支持JSON格式的结构化日志，包含以下字段：
- `time`: 时间戳
- `level`: 日志级别
- `msg`: 日志消息
- `trace_info`: 追踪信息（包含请求、响应、SQL、Redis等）

## 故障排除

### 常见问题

1. **页面无法访问**
   - 检查服务器是否正常运行
   - 确认端口9999是否被占用
   - 检查防火墙设置

2. **日志不显示**
   - 确认日志文件路径是否正确
   - 检查日志文件权限
   - 验证日志格式是否符合要求

3. **自动刷新不工作**
   - 检查浏览器JavaScript是否启用
   - 确认网络连接正常
   - 查看浏览器控制台是否有错误

### 调试方法

1. **查看API响应**
   ```bash
   curl -s http://localhost:9999/system/logs/unified | jq '.'
   ```

2. **检查日志文件**
   ```bash
   tail -f /path/to/access.log
   ```

3. **浏览器开发者工具**
   - 打开F12开发者工具
   - 查看Network标签页的API请求
   - 检查Console标签页的错误信息

## 更新日志

### v1.0.0 (2024-08-15)
- 初始版本发布
- 支持统一日志监控
- 实现多类型日志展示
- 添加过滤和搜索功能
- 支持自动刷新和分页

## 贡献指南

欢迎提交Issue和Pull Request来改进这个日志监控面板。

## 许可证

MIT License
