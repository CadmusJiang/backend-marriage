# 实时日志查看器

## 概述

实时日志查看器是一个现代化的Web界面，用于实时监控和查看后端API请求日志。它提供了直观的界面来查看请求详情、响应时间、成功/失败状态等信息。

## 功能特性

### 🚀 核心功能
- **实时日志显示**: 实时显示API请求日志
- **自动刷新**: 支持自动刷新功能，每2秒更新一次
- **过滤功能**: 支持按HTTP方法、状态、路径进行过滤
- **统计信息**: 显示总请求数、成功/失败请求数、平均响应时间
- **响应时间监控**: 实时显示每个请求的响应时间

### 🎨 界面特性
- **现代化设计**: 使用Bootstrap框架，界面美观
- **颜色编码**: 不同HTTP方法使用不同颜色标识
- **状态标识**: 成功/失败请求使用不同颜色和图标
- **响应式设计**: 支持移动端和桌面端访问

### 📊 数据展示
- **请求方法**: GET、POST、PUT、DELETE等
- **请求路径**: 完整的API路径
- **响应状态**: HTTP状态码
- **响应时间**: 毫秒级精度
- **TraceID**: 用于追踪请求链路
- **时间戳**: 请求发生的时间

## 访问方式

### 1. Web界面
```
http://localhost:9999/logs
```

### 2. API接口
```bash
# 获取日志列表
GET /api/v1/logs

# 获取实时日志
GET /api/v1/logs/realtime
```

## 使用说明

### 1. 基本操作
1. 打开浏览器访问 `http://localhost:9999/logs`
2. 页面会自动加载最新的日志记录
3. 点击"自动刷新"按钮开启实时监控
4. 使用过滤器筛选特定类型的请求

### 2. 过滤功能
- **方法过滤**: 选择特定的HTTP方法（GET、POST、PUT、DELETE）
- **状态过滤**: 筛选成功或失败的请求
- **路径过滤**: 输入关键词过滤特定路径的请求

### 3. 统计信息
页面顶部显示四个统计卡片：
- **总请求数**: 所有请求的总数
- **成功请求**: 状态码为200的请求数
- **失败请求**: 状态码非200的请求数
- **平均响应时间**: 所有请求的平均响应时间

## API接口详情

### 获取日志列表
```http
GET /api/v1/logs
```

**查询参数:**
- `limit`: 获取条数（默认50）

**响应示例:**
```json
{
  "data": [
    {
      "level": "info",
      "time": "2023-12-01T12:00:00Z",
      "path": "/api/v1/accounts",
      "http_code": 200,
      "method": "GET",
      "msg": "trace-log",
      "trace_id": "trace_20231201120000_001",
      "content": "完整的日志内容",
      "cost_seconds": 0.123,
      "success": true
    }
  ],
  "total": 50,
  "success": true,
  "last_time": "2023-12-01T12:00:00Z"
}
```

### 获取实时日志
```http
GET /api/v1/logs/realtime
```

**请求头:**
- `since`: 起始时间（可选）

**响应示例:**
```json
{
  "data": [
    {
      "level": "info",
      "time": "2023-12-01T12:01:00Z",
      "path": "/api/v1/groups",
      "http_code": 200,
      "method": "GET",
      "msg": "trace-log",
      "trace_id": "trace_20231201120100_002",
      "content": "完整的日志内容",
      "cost_seconds": 0.045,
      "success": true
    }
  ],
  "total": 10,
  "success": true,
  "last_time": "2023-12-01T12:01:00Z"
}
```

## 技术实现

### 后端实现
- **日志解析**: 解析JSON格式的日志文件
- **实时监控**: 支持增量获取新日志
- **性能优化**: 限制返回数量，避免内存溢出
- **错误处理**: 完善的错误处理和异常捕获

### 前端实现
- **AJAX请求**: 使用jQuery进行异步请求
- **实时更新**: 定时器实现自动刷新
- **数据过滤**: JavaScript实现客户端过滤
- **响应式布局**: Bootstrap实现响应式设计

## 配置说明

### 日志文件路径
默认日志文件路径：`./logs/marriage_system-access.log`

### 日志格式
系统使用JSON格式记录日志，包含以下字段：
- `level`: 日志级别
- `time`: 时间戳
- `method`: HTTP方法
- `path`: 请求路径
- `http_code`: HTTP状态码
- `cost_seconds`: 响应时间
- `success`: 是否成功
- `trace_id`: 追踪ID

## 测试方法

### 1. 启动服务
```bash
go run main.go
```

### 2. 访问日志页面
```bash
open http://localhost:9999/logs
```

### 3. 生成测试请求
```bash
# 测试脚本
./scripts/test_logs_viewer.sh
```

### 4. 手动测试API
```bash
# 获取日志列表
curl -X GET http://localhost:9999/api/v1/logs

# 获取实时日志
curl -X GET http://localhost:9999/api/v1/logs/realtime
```

## 注意事项

1. **权限**: 日志查看API无需认证，可直接访问
2. **性能**: 大量日志可能影响性能，建议定期清理日志文件
3. **安全**: 生产环境建议限制访问权限
4. **存储**: 日志文件会持续增长，注意磁盘空间

## 故障排除

### 1. 页面无法访问
- 检查服务是否正常启动
- 确认端口9999是否被占用
- 查看控制台错误信息

### 2. 日志不显示
- 检查日志文件是否存在
- 确认日志文件格式是否正确
- 查看API接口返回状态

### 3. 自动刷新不工作
- 检查网络连接
- 确认API接口是否正常
- 查看浏览器控制台错误

## 扩展功能

### 可能的扩展
- **日志导出**: 支持导出日志到文件
- **高级过滤**: 支持更复杂的过滤条件
- **图表展示**: 添加图表展示统计信息
- **告警功能**: 异常请求自动告警
- **用户权限**: 添加访问权限控制

## 总结

实时日志查看器提供了一个直观、高效的界面来监控后端API请求。它不仅能帮助开发者快速定位问题，还能提供有价值的性能统计信息。通过现代化的Web界面，用户可以轻松地查看和分析系统运行状态。 